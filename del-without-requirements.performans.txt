#PowerShell Script — “Listedekiler dışındaki Python paketlerini kaldır”
#requirements.txt → KALACAK paketler

# Bunun dışındaki her paket → silinir

#Kullanım:
#VSCode kapalı olsun → PowerShell → script’i çalıştır.
------------------------------------------------------------

# Path to allowed library list
$allowedListPath = "requirements.txt"

# Read allowed items (strip==versions becomes just package names)
$allowedRaw = Get-Content $allowedListPath | ForEach-Object { $_.Trim() } | Where-Object { $_ -ne "" }

# Normalize allowed names (remove version specifiers)
$allowed = @()
foreach ($line in $allowedRaw) {
    # Remove extras like ==1.2.3 or >= or <= etc.
    $pkg = $line -replace "([<>=].*)$", ""
    if ($pkg -ne "") { $allowed += $pkg.ToLower() }
}

Write-Host "`nAllowed packages:" -ForegroundColor Cyan
$allowed | ForEach-Object { Write-Host "  $_" }

# Get installed pip packages
$installed = pip list --format=json | ConvertFrom-Json

Write-Host "`nInstalled packages:" -ForegroundColor Yellow
$installed.name | ForEach-Object { Write-Host "  $_" }

# Determine packages to remove
$toRemove = @()
foreach ($pkg in $installed) {
    if ($allowed -notcontains $pkg.name.ToLower()) {
        $toRemove += $pkg.name
    }
}

Write-Host "`nPackages to REMOVE:" -ForegroundColor Red
$toRemove | ForEach-Object { Write-Host "  $_" }

# Confirmation
Write-Host "`nProceed with uninstalling these packages? (Y/N)" -ForegroundColor Magenta
$confirm = Read-Host

if ($confirm -eq "Y") {

    foreach ($pkg in $toRemove) {
        Write-Host "Uninstalling $pkg..." -ForegroundColor Red
        pip uninstall $pkg -y
    }

    Write-Host "`nCleanup complete." -ForegroundColor Green

} else {
    Write-Host "Aborted." -ForegroundColor Yellow
}
